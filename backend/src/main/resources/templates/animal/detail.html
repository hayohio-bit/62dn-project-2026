<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section}, ${animal.name})}">
<section>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/animals}">Animals</a></li>
            <li class="breadcrumb-item active" aria-current="page" th:text="${animal.name}">이름</li>
        </ol>
    </nav>

    <div class="row g-5">
        <div class="col-md-6">
            <img th:src="${animal.imageUrl != null} ? ${animal.imageUrl} : 'https://via.placeholder.com/600x450?text=No+Image'" 
                 class="img-fluid rounded shadow" alt="Animal Image">
        </div>
        <div class="col-md-6">
            <h1 class="display-5 fw-bold" th:text="${animal.name}">이름</h1>
            <p class="fs-4">
                <span class="badge bg-primary" th:text="${animal.species}">품종</span>
                <span class="badge bg-secondary" th:text="${animal.status}">상태</span>
            </p>
            
            <hr class="my-4">
            
            <ul class="list-group list-group-flush mb-4">
                <li class="list-group-item"><strong>품종:</strong> <span th:text="${animal.breed}">진도믹스</span></li>
                <li class="list-group-item"><strong>나이:</strong> <span th:text="${animal.age}">3</span>살</li>
                <li class="list-group-item"><strong>성별:</strong> <span th:text="${animal.gender}">수컷</span></li>
                <li class="list-group-item"><strong>몸무게:</strong> <span th:text="${animal.weight}">12.5</span>kg</li>
                <li class="list-group-item"><strong>중성화 여부:</strong> <span th:text="${animal.neutered} ? '완료' : '미완료'">완료</span></li>
                <li class="list-group-item"><strong>건강 상태:</strong> <span th:text="${animal.healthStatus}">양호</span></li>
            </ul>

            <div th:if="${animal.status == T(com.antigravity.animal.entity.AnimalStatus).AVAILABLE}">
                <button type="button" class="btn btn-lg btn-success w-100" data-bs-toggle="modal" data-bs-target="#adoptionModal">
                    입양 신청하기
                </button>
            </div>
            <div th:unless="${animal.status == T(com.antigravity.animal.entity.AnimalStatus).AVAILABLE}">
                <button class="btn btn-lg btn-secondary w-100" disabled>현재 입양 불가능</button>
            </div>
        </div>
    </div>

    <!-- Adoption Modal -->
    <div class="modal fade" id="adoptionModal" tabindex="-1" aria-labelledby="adoptionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adoptionModalLabel">입양 신청서 작성</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="adoptionForm">
                        <input type="hidden" name="animalId" th:value="${animal.id}">
                        <div class="mb-3">
                            <label for="applicantName" class="form-label">이름</label>
                            <input type="text" class="form-control" id="applicantName" name="applicantName" required>
                        </div>
                        <div class="mb-3">
                            <label for="applicantContact" class="form-label">연락처</label>
                            <input type="text" class="form-control" id="applicantContact" name="applicantContact" placeholder="010-0000-0000" required>
                        </div>
                        <div class="mb-3">
                            <label for="reason" class="form-label">입양 희망 사유</label>
                            <textarea class="form-control" id="reason" name="reason" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="submitAdoption()">제출하기</button>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        function submitAdoption() {
            const formData = {
                animalId: document.querySelector('input[name="animalId"]').value,
                applicantName: document.getElementById('applicantName').value,
                applicantContact: document.getElementById('applicantContact').value,
                reason: document.getElementById('reason').value
            };

            fetch('/api/adoptions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            }).then(response => {
                if (response.ok) {
                    alert('입양 신청이 완료되었습니다.');
                    location.reload();
                } else {
                    alert('신청 중 오류가 발생했습니다.');
                }
            });
        }
    </script>
</section>
</html>
