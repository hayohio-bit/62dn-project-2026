name: ğŸš€ Auto Push & PR
on:
  workflow_dispatch:  # ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì‹¤í–‰

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸ”§ Setup GitHub CLI
      uses: github/gh-cli-setup@v1
      
    - name: âš™ï¸ Auto-config Git CLI
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        gh auth login --with-token < <(echo "$GH_TOKEN")
        gh auth status
    
    - name: ğŸ“ Auto commit & push
      run: |
        chmod +x .github/scripts/auto-deploy.sh
        .github/scripts/auto-deploy.sh
    
    - name: ğŸ”— Auto create PR
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
        gh pr create \
          --base main \
          --head "$CURRENT_BRANCH" \
          --title "ğŸš€ Auto Deploy PR from $CURRENT_BRANCH" \
          --body "ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê²°ê³¼ì…ë‹ˆë‹¤.\n\n$(date)" \
          --web