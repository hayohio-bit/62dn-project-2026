name: ğŸš€ Auto Push & PR

on:
  workflow_dispatch:
    inputs:
      description:
        description: "âš ï¸ ì‘ì—… ë¸Œëœì¹˜(ì˜ˆ: shy, feature/...) ì„ íƒ! mainì—ì„œ ì‹¤í–‰ âŒ"
        required: false
        default: "í˜„ì¬ HEAD ë¸Œëœì¹˜ ìë™ ì‚¬ìš©"

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      # âœ… gh auth login ì œê±°, Git + remoteë§Œ ì„¸íŒ…
      - name: âš™ï¸ Setup Git & Auth
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git

      - name: ğŸ“ Auto commit & push
        run: |
          chmod +x .github/scripts/auto-deploy.sh
          .github/scripts/auto-deploy.sh

      - name: ğŸ”— Auto create PR
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
          gh pr create \
            --base main \
            --head "$CURRENT_BRANCH" \
            --title "ğŸš€ Auto Deploy PR from $CURRENT_BRANCH" \
            --body "ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê²°ê³¼ì…ë‹ˆë‹¤.\n\n$(date)" \
            --web
